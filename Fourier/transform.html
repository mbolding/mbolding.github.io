<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fourier Transform Demo</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        #controlPanel {
            margin-bottom: 20px;
        }
        canvas {
            border: 1px solid #ccc;
        }
    </style>
</head>
<body>
    <h1>Fourier Transform Demo</h1>
    <div id="controlPanel">
        <label for="waveType">Wave Type:</label>
        <select id="waveType">
            <option value="sine">Sine</option>
            <option value="square">Square</option>
            <option value="sawtooth">Sawtooth</option>
        </select>
        <label for="frequency">Frequency:</label>
        <input type="range" id="frequency" min="1" max="10" value="1" step="0.1">
        <span id="frequencyValue">1 Hz</span>
    </div>
    <div id="canvas-container"></div>

    <script>
        let waveType;
        let frequency;
        let time = 0;
        let fft;

        function setup() {
            const canvas = createCanvas(800, 400);
            canvas.parent('canvas-container');
            waveType = select('#waveType');
            frequency = select('#frequency');
            fft = new p5.FFT();
        }

        function draw() {
            background(240);
            
            // Generate the waveform
            let wave = [];
            for (let i = 0; i < width; i++) {
                let angle = map(i, 0, width, 0, TWO_PI);
                let y;
                switch (waveType.value()) {
                    case 'sine':
                        y = sin(angle * frequency.value() + time);
                        break;
                    case 'square':
                        y = sin(angle * frequency.value() + time) > 0 ? 1 : -1;
                        break;
                    case 'sawtooth':
                        y = (angle * frequency.value() + time) % TWO_PI / PI - 1;
                        break;
                }
                wave[i] = y;
            }

            // Draw the waveform
            noFill();
            stroke(0);
            beginShape();
            for (let i = 0; i < wave.length; i++) {
                let x = i;
                let y = map(wave[i], -1, 1, height / 4, 0);
                vertex(x, y);
            }
            endShape();

            // Perform FFT
            fft.analyze();
            let spectrum = fft.spectrum();

            // Draw the frequency spectrum
            noStroke();
            fill(0, 0, 255, 100);
            for (let i = 0; i < spectrum.length; i++) {
                let x = map(i, 0, spectrum.length, 0, width);
                let h = map(spectrum[i], 0, 255, 0, height / 4);
                rect(x, height - h, width / spectrum.length, h);
            }

            // Update time
            time += 0.05;

            // Update frequency display
            select('#frequencyValue').html(frequency.value() + ' Hz');
        }
    </script>
</body>
</html>